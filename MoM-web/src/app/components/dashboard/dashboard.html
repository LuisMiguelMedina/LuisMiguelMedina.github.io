<!-- Dashboard Header -->
<div class="matrix-page-header">
  <div class="header-title">
    <h3><i class="fas fa-server me-2"></i>Análisis del Servidor</h3>
    @if (adminSession()) {
    <div class="welcome-text">> CENTRO DE CONTROL DIMENSION-2</div>
    }
  </div>
  <div class="header-stats">
    <div class="live-stat">
      <span class="stat-label">TPS:</span>
      <span class="stat-value green">{{ currentTPS.toFixed(1) }}</span>
    </div>
    <div class="live-stat">
      <span class="stat-label">MEM:</span>
      <span class="stat-value amber">{{ memoryUsed.toFixed(1) }}GB/{{ memoryTotal }}GB</span>
    </div>
    <div class="live-stat">
      <span class="stat-label">FIREBASE:</span>
      @if (networkPing >= 0) {
      <span class="stat-value cyan">{{ networkPing }}ms</span>
      } @else {
      <span class="stat-value red">ERROR</span>
      }
    </div>
    <div class="live-stat">
      <span class="stat-label">DB:</span>
      @if (isConnected()) {
      <span class="stat-value green"><i class="fas fa-circle"></i> CONECTADO</span>
      } @else {
      <span class="stat-value red"><i class="fas fa-circle"></i> DESCONECTADO</span>
      }
    </div>
  </div>
</div>

<!-- Server Genesis Banner -->
<div class="genesis-banner">
  <div class="genesis-content">
    <div class="genesis-icon">
      <i class="fas fa-infinity"></i>
    </div>
    <div class="genesis-info">
      <div class="genesis-label">INICIO DEL SERVIDOR</div>
      <div class="genesis-date">{{ serverGenesis }}</div>
    </div>
    <div class="genesis-divider"></div>
    <div class="genesis-info">
      <div class="genesis-label">TIEMPO TOTAL</div>
      <div class="genesis-date">{{ serverUptime }}</div>
    </div>
    <div class="genesis-divider"></div>
    <div class="genesis-info">
      <div class="genesis-label">ESTADO</div>
      <div class="genesis-date">
        <span class="status-online"><i class="fas fa-circle"></i> OPERATIVO</span>
      </div>
    </div>
  </div>
</div>

<!-- Metrics Cards Row -->
<div class="row mb-4">
  @for (metric of metrics; track metric.label) {
  <div class="col-md-6 col-xl-3 mb-4">
    <div class="matrix-card" [attr.data-color]="metric.color">
      <div class="card-body">
        <div class="row g-0 align-items-center">
          <div class="col me-2">
            <div class="card-label">{{ metric.label }}</div>
            <div class="card-value">{{ metric.value }}</div>
            @if (metric.subtext) {
            <div class="card-subtext">{{ metric.subtext }}</div>
            }
          </div>
          <div class="col-auto">
            <i [class]="metric.icon + ' card-icon'"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>

<!-- Dimension Status Row -->
<div class="row mb-4">
  <div class="col-12">
    <div class="matrix-chart-container">
      <div class="chart-header">
        <h6><i class="fas fa-globe-americas me-2"></i>Estado de Dimensiones</h6>
      </div>
      <div class="dimension-grid">
        @for (dim of dimensions; track dim.id) {
        <div class="dimension-card" [class]="getStatusClass(dim.status)">
          <div class="dimension-header">
            <span class="dimension-name">{{ dim.name }}</span>
            <span class="dimension-status">{{ dim.status }}</span>
          </div>
          <div class="dimension-body">
            <div class="integrity-row">
              <span class="integrity-label">Integridad:</span>
              <span class="integrity-value">{{ dim.integrity.toFixed(1) }}%</span>
            </div>
            <div class="integrity-bar">
              <div class="integrity-fill" [style.width.%]="dim.integrity" [style.background]="dim.color"></div>
            </div>
            <div class="sync-info">
              <i class="fas fa-sync-alt"></i>
              Última sync: {{ dim.lastSync }}
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>

<!-- Activity and System Status Row -->
<div class="row">
  <!-- Recent Events -->
  <div class="col-lg-7 mb-4">
    <div class="matrix-chart-container">
      <div class="chart-header">
        <h6><i class="fas fa-history me-2"></i>Eventos Recientes</h6>
      </div>
      <div class="events-list">
        @for (event of recentEvents; track event.timestamp) {
        <div class="event-item" [class]="event.type">
          <div class="event-icon">
            <i [class]="getEventIcon(event.type)"></i>
          </div>
          <div class="event-content">
            <div class="event-header">
              <span class="event-source">[{{ event.source }}]</span>
              <span class="event-time">{{ event.timestamp | date:'short' }}</span>
            </div>
            <div class="event-message">{{ event.message }}</div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>

  <!-- System Resources - Level 2+ -->
  @if (adminLevel() >= 2) {
  <div class="col-lg-5 mb-4">
    <div class="matrix-chart-container">
      <div class="chart-header">
        <h6><i class="fas fa-microchip me-2"></i>Recursos del Sistema</h6>
      </div>
      <div class="p-3">
        <div class="resource-item">
          <div class="resource-header">
            <span class="resource-label">USO_CPU:</span>
            <span class="resource-value green">42%</span>
          </div>
          <div class="matrix-progress progress">
            <div class="progress-bar" style="width: 42%;"></div>
          </div>
        </div>

        <div class="resource-item">
          <div class="resource-header">
            <span class="resource-label">USO_MEMORIA:</span>
            <span class="resource-value amber">{{ ((memoryUsed / memoryTotal) * 100).toFixed(0) }}%</span>
          </div>
          <div class="matrix-progress progress">
            <div class="progress-bar amber" [style.width.%]="(memoryUsed / memoryTotal) * 100"></div>
          </div>
        </div>

        <div class="resource-item">
          <div class="resource-header">
            <span class="resource-label">USO_DISCO:</span>
            <span class="resource-value cyan">35%</span>
          </div>
          <div class="matrix-progress progress">
            <div class="progress-bar" style="width: 35%;"></div>
          </div>
        </div>

        <div class="resource-item">
          <div class="resource-header">
            <span class="resource-label">ANCLAJES_REALIDAD:</span>
            <span class="resource-value green">
              <i class="fas fa-check-circle me-1"></i>4/4 ACTIVOS
            </span>
          </div>
        </div>

        <div class="resource-item">
          <div class="resource-header">
            <span class="resource-label">CAMPO_CONTENCION:</span>
            <span class="resource-value amber">
              <i class="fas fa-shield-alt me-1"></i>ESTABLE
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>

<!-- Level 1 Restricted Message -->
@if (adminLevel() < 2) { <div class="row">
  <div class="col-12">
    <div class="matrix-chart-container text-center" style="padding: 3rem;">
      <i class="fas fa-lock" style="font-size: 3rem; color: var(--terminal-gray); margin-bottom: 1rem;"></i>
      <p style="font-family: var(--font-terminal); color: var(--terminal-gray); letter-spacing: 2px;">
        [ NIVEL DE ACCESO INSUFICIENTE ]
      </p>
      <small style="color: var(--terminal-cyan-dim);">
        Métricas avanzadas del sistema requieren nivel 2 o superior
      </small>
    </div>
  </div>
  </div>
  }